!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Falldown={})}(this,(function(e){"use strict";const t={thresshold:10,clicked:!0,doubleClicked:!1,doubleClickedTime:300,longClicked:!1,longClickedTime:500,capture:!1,clickDown:!1};function s(e,t,s){return new o(e,t,s)}class o{constructor(e,s,o){"string"!=typeof e||(e=document.querySelector(e))?(this.options=Object.assign({},t,o),this.events={mousedown:e=>this.mousedown(e),mouseup:e=>this.mouseup(e),mousemove:e=>this.mousemove(e),touchstart:e=>this.touchstart(e),touchmove:e=>this.touchmove(e),touchcancel:e=>this.cancel(e),touchend:e=>this.touchend(e)},e.addEventListener("mousedown",this.events.mousedown,{capture:this.options.capture}),e.addEventListener("mouseup",this.events.mouseup,{capture:this.options.capture}),e.addEventListener("mousemove",this.events.mousemove,{capture:this.options.capture}),e.addEventListener("touchstart",this.events.touchstart,{passive:!0,capture:this.options.capture}),e.addEventListener("touchmove",this.events.touchmove,{passive:!0,capture:this.options.capture}),e.addEventListener("touchcancel",this.events.touchcancel,{capture:this.options.capture}),e.addEventListener("touchend",this.events.touchend,{capture:this.options.capture}),this.element=e,this.callback=s):console.warn(`Unknown element: document.querySelector(${e}) in clicked()`)}destroy(){this.element.removeEventListener("mousedown",this.events.mousedown),this.element.removeEventListener("mouseup",this.events.mouseup),this.element.removeEventListener("mousemove",this.events.mousemove),this.element.removeEventListener("touchstart",this.events.touchstart,{passive:!0}),this.element.removeEventListener("touchmove",this.events.touchmove,{passive:!0}),this.element.removeEventListener("touchcancel",this.events.touchcancel),this.element.removeEventListener("touchend",this.events.touchend)}touchstart(e){!0===this.down?this.cancel():1===e.touches.length&&this.handleDown(e.changedTouches[0].screenX,e.changedTouches[0].screenY)}pastThreshhold(e,t){return Math.abs(this.lastX-e)>this.threshhold||Math.abs(this.lastY-t)>this.threshhold}touchmove(e){if(this.down)if(1!==e.touches.length)this.cancel();else{const t=e.changedTouches[0].screenX,s=e.changedTouches[0].screenY;this.pastThreshhold(t,s)&&this.cancel()}}cancel(){this.down=!1,this.doubleClickedTimeout&&(clearTimeout(this.doubleClickedTimeout),this.doubleClickedTimeout=null),this.longClickedTimeout&&(clearTimeout(this.longClickedTimeout),this.longClickedTimeout=null)}touchend(e){this.down&&(e.preventDefault(),this.handleClicks(e,e.pointerId))}handleClicks(e){this.options.doubleClicked?this.doubleClickedTimeout=setTimeout(()=>this.doubleClicked(e),this.options.doubleClickedTime):this.options.clicked&&this.callback({event:e,type:"clicked"}),this.longClickedTimeout&&(clearTimeout(this.longClickedTimeout),this.longClickedTimeout=null),this.down=!1}handleDown(e,t,s){this.doubleClickedTimeout?this.pastThreshhold(t,s)?(this.options.clicked&&this.callback({event:e,type:"clicked"}),this.cancel()):(this.callback({event:e,type:"double-clicked"}),this.cancel()):(this.lastX=t,this.lastY=s,this.down=!0,this.options.longClicked&&(this.longClickedTimeout=setTimeout(()=>this.longClicked(e),this.options.longClickedTime)),this.options.clickDown&&this.callback({event:e,type:"click-down"}))}longClicked(e){this.longClikedTimeout=null,this.down=!1,this.callback({event:e,type:"long-clicked"})}doubleClicked(e){this.doubleClickedTimeout=null,this.callback({event:e,type:"double-clicked"})}mousedown(e){!0===this.down?this.down=!1:this.handleDown(e,e.screenX,e.screenY)}mousemove(e){if(this.down){const t=e.screenX,s=e.screenY;this.pastThreshhold(t,s)&&this.cancel()}}mouseup(e){this.down&&(e.preventDefault(),this.handleClicks(e))}}var i=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t=Object.prototype.hasOwnProperty,s="~";function o(){}function i(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function l(e,t,o,l,n){if("function"!=typeof o)throw new TypeError("The listener must be a function");var c=new i(o,l||e,n),a=s?s+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function n(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(s=!1)),c.prototype.eventNames=function(){var e,o,i=[];if(0===this._eventsCount)return i;for(o in e=this._events)t.call(e,o)&&i.push(s?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},c.prototype.listeners=function(e){var t=s?s+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var i=0,l=o.length,n=new Array(l);i<l;i++)n[i]=o[i].fn;return n},c.prototype.listenerCount=function(e){var t=s?s+e:e,o=this._events[t];return o?o.fn?1:o.length:0},c.prototype.emit=function(e,t,o,i,l,n){var c=s?s+e:e;if(!this._events[c])return!1;var a,h,r=this._events[c],d=arguments.length;if(r.fn){switch(r.once&&this.removeListener(e,r.fn,void 0,!0),d){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,t),!0;case 3:return r.fn.call(r.context,t,o),!0;case 4:return r.fn.call(r.context,t,o,i),!0;case 5:return r.fn.call(r.context,t,o,i,l),!0;case 6:return r.fn.call(r.context,t,o,i,l,n),!0}for(h=1,a=new Array(d-1);h<d;h++)a[h-1]=arguments[h];r.fn.apply(r.context,a)}else{var u,p=r.length;for(h=0;h<p;h++)switch(r[h].once&&this.removeListener(e,r[h].fn,void 0,!0),d){case 1:r[h].fn.call(r[h].context);break;case 2:r[h].fn.call(r[h].context,t);break;case 3:r[h].fn.call(r[h].context,t,o);break;case 4:r[h].fn.call(r[h].context,t,o,i);break;default:if(!a)for(u=1,a=new Array(d-1);u<d;u++)a[u-1]=arguments[u];r[h].fn.apply(r[h].context,a)}}return!0},c.prototype.on=function(e,t,s){return l(this,e,t,s,!1)},c.prototype.once=function(e,t,s){return l(this,e,t,s,!0)},c.prototype.removeListener=function(e,t,o,i){var l=s?s+e:e;if(!this._events[l])return this;if(!t)return n(this,l),this;var c=this._events[l];if(c.fn)c.fn!==t||i&&!c.once||o&&c.context!==o||n(this,l);else{for(var a=0,h=[],r=c.length;a<r;a++)(c[a].fn!==t||i&&!c[a].once||o&&c[a].context!==o)&&h.push(c[a]);h.length?this._events[l]=1===h.length?h[0]:h:n(this,l)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&n(this,t)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=s,c.EventEmitter=c,e.exports=c})),l={".falldown-main":{display:"flex"},".falldown-label":{cursor:"pointer","margin-right":"0.5em"},".falldown-selection":{cursor:"pointer",border:"1px dotted black",position:"relative",display:"flex"},".falldown-label:empty":{margin:"0"},".falldown-box":{position:"absolute",border:"1px solid black",background:"white","box-shadow":"0 0 0.25rem rgba(0, 0, 0, 0.25)",padding:"1rem",display:"none",width:"fit-content","white-space":"nowrap","z-index":"2",overflow:"auto","-webkit-overflow-scrolling":"touch"},".falldown-select":{color:"white",background:"black"},".falldown-arrow":{"margin-left":"0.5rem",display:"inline-block","user-select":"none","align-self":"center"},".falldown-option":{cursor:"pointer"},".falldown-option:hover":{background:"rgba(0, 0, 0, 0.25)"},".falldown-cursor":{background:"rgba(0, 0, 0, 0.5)",color:"white"},".falldown-selected":{display:"inline-block","white-space":"nowrap"},".falldown-selection:focus":{outline:"none"},".falldown-focus":{border:"1px solid black"}};class n extends i{constructor(e={}){if(super(),n.setup||(window.addEventListener("resize",n.resize),window.addEventListener("keydown",n.keydown),n.setup=!0),e.element)if("string"==typeof e.element){if(this.element=document.querySelector(e.element),!this.element)return void console.warn(`Falldown could not find document.querySelector(${e.element})`)}else this.element=e.element;else this.element=document.createElement("div");(e.addCSS||this.element.getAttribute("data-add-css"))&&this.addStyles(e),this.options=e,this.setupOptions(),this.element.classList.add(e.classNames.main);let t=`<div class="${e.classNames.label}">${e.label}</div>`+`<div class="${e.classNames.selection}" tabindex="0">`+`<div class="${e.classNames.selected}"></div>`+(e.arrow?`<div class="${e.classNames.arrow}">${e.arrow.down}</div>`:"")+`<div class="${e.classNames.box}">`;this.optionsToFallDownOptions(e);for(let s of this.falldown)t+=`<div class="${e.classNames.option}${s.selected?` ${e.classNames.select}`:""}">${s.html}</div>`;t+="</div></div>",this.element.innerHTML=t,this.showing=!1,this.label=this.element.querySelector("."+e.classNames.label),this.selection=this.element.querySelector("."+e.classNames.selection),this.selection.setAttribute("tabindex",this.selection.getAttribute("tabindex")||0),this.selected=this.selection.querySelector("."+e.classNames.selected),this.arrow=this.element.querySelector("."+e.classNames.arrow),this.box=this.selection.querySelector("."+e.classNames.box),e.parent&&e.parent.appendChild(this.element);const o=this.box.querySelectorAll("."+e.classNames.option);for(let e=0;e<o.length;e++)s(o[e],()=>{this.cursorActive=!1,this.emit("select",this.select(e)),this.options.multiple?this.clearCursor():this.close()});if(this.cursor=null,this.options=e,s(this.label,()=>this.toggle(),{clicked:!1,clickDown:!0}),this.arrow&&s(this.arrow,()=>this.toggle(),{clicked:!1,clickDown:!0}),s(this.selected,()=>this.toggle(),{clicked:!1,clickDown:!0}),this.selection.addEventListener("focus",()=>{this.focused=!0,this.selection.classList.add(this.options.classNames.focus),n.active=this}),this.selection.addEventListener("blur",()=>this.blur()),this.box.style.display="block",this.options.size)this.selected.style.width=this.options.size,this.selected.style.overflow="hidden";else if("longest"===this.options.minSize){let e=0;for(let t=0;t<this.box.childNodes.length;t++){const s=this.box.childNodes[t].offsetWidth;e=s>e?s:e,this.selected.style.minWidth=e+"px"}}else this.selected.style.minWidth=this.options.minSize;e.allowEdit||(this.selected.style.userSelect="none"),this.showSelection(),this.box.style.display="none"}blur(){this.showing&&(this.focused=!1,this.close(),this.selection.classList.remove(this.options.classNames.focus),n.active===this&&(n.active=null))}toggle(){this.showing?this.close():this.open()}optionsToFallDownOptions(e){this.falldown=[];let t=[];if(e.selected)if(Array.isArray(e.selected))if("string"!=typeof e.selected[0]&&isNaN(e.selected[0]))for(let s of e.selected)t.push(s.value);else t=e.selected;else"string"!=typeof e.selected&&isNaN(e.selected)?t.push(e.selected.value):-1!==e.selected.indexOf(e.separatorOptions)?t=e.selected.split(e.separatorOptions):t.push(e.selected);for(let s=0;s<e.options.length;s++){const o=e.options[s];"string"!=typeof o&&isNaN(o)?(this.falldown.push(o),o.selected=o.selected||-1!==t.indexOf(o.value)):this.falldown.push({value:o,html:o,selected:-1!==t.indexOf(o)})}}get value(){const e=[];for(let t of this.falldown)t.selected&&e.push(t.value);return this.options.multiple?e:e[0]}setupOptions(){const e=this.options,t=this.element;e.selected=e.selected||t.getAttribute("data-selected")||"";const s=t.getAttribute("data-options");if(e.options=e.options||(s?s.split(e.separatorOptions||","):[]),e.label=e.label||t.getAttribute("data-label")||"",e.multiple=e.multiple||t.getAttribute("data-multiple"),e.multipleName=e.multipleName||t.getAttribute("data-multiple-name"),e.arrow=void 0===e.arrow?{up:"&#9652",down:"&#9662;"}:e.arrows,e.minSize=e.minSize||t.getAttribute("data-minsize")||"longest",e.classNames||(e.classNames={}),e.classNames.main=e.classNames.main||"falldown-main",e.classNames.label=e.classNames.label||"falldown-label",e.classNames.selection=e.classNames.selection||"falldown-selection",e.classNames.box=e.classNames.box||"falldown-box",e.classNames.select=e.classNames.select||"falldown-select",e.classNames.selected=e.classNames.selected||"falldown-selected",e.classNames.arrow=e.classNames.arrow||"falldown-arrow",e.classNames.option=e.classNames.option||"falldown-option",e.classNames.cursor=e.classNames.cursor||"falldown-cursor",e.classNames.focus=e.classNames.focus||"falldown-focus",e.addCSSClassName)for(let t in e.classNames)e.classNames[t]=e.classNames[t].replace("falldown",e.addCSSClassName)}addStyles(e){e.styles=e.styles||{};let t="";for(let s in l){const o=e.addCSSClassName?s.replace("falldown",e.addCSSClassName):s,i=s.replace(".falldown-","");t+=o+"{";for(let o in l[s]){const n=e.styles[i];n&&n[o]||(t+=o+":"+l[s][o]+";")}for(let s in e.styles[i])t+=s+":"+e.styles[i][s]+";";t+="}"}const s=document.createElement("style");s.innerText=t,document.head.appendChild(s)}open(){this.showing||(this.box.style.display="block",this.options.arrow&&(this.arrow.innerHTML=this.options.arrow.up),this.resizeBox(),n.active=this,this.cursor=null,this.showing=!0,this.selection.focus())}resizeBox(){const e=window.innerWidth,t=window.innerHeight;let s=this.box.getBoundingClientRect();const o=this.selected.getBoundingClientRect();if(this.box.style.maxHeight="unset",o.top+o.height/2>t/2){this.box.style.bottom=this.selection.offsetHeight+"px",this.box.style.top="unset";const e=this.box.getBoundingClientRect();if(e.top<0){const t=window.getComputedStyle(this.box),s=parseFloat(t.marginLeft)+parseFloat(t.marginRight)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderLeftWidth)+parseFloat(t.borderRightWidth);this.box.style.maxHeight=e.height+e.top-s+"px"}}else{this.box.style.top=this.selection.offsetHeight+"px",this.box.style.bottom="unset";const e=this.box.getBoundingClientRect();if(e.bottom>t){const s=window.getComputedStyle(this.box),o=parseFloat(s.marginTop)+parseFloat(s.marginBottom)+parseFloat(s.paddingTop)+parseFloat(s.paddingBottom)+parseFloat(s.borderTopWidth)+parseFloat(s.borderBottomWidth);this.box.style.maxHeight=t-e.top-o+"px"}}this.box.style.width="fit-content",o.left>=e/2?(this.box.style.right=0,this.box.style.left="unset",s=this.box.getBoundingClientRect(),s.left<0&&(this.box.style.right=s.left+"px",this.box.style.left="unset")):(this.box.style.left=0,this.box.style.right="unset",s=this.box.getBoundingClientRect(),s.right>=e&&(this.box.style.left=e-s.right+"px",this.box.style.right="unset"));const i=this.box.getBoundingClientRect();if(i.left<0||i.right>window.innerWidth){const e=this.element.getBoundingClientRect();this.box.style.width="calc(100vw - 2rem - 4px)",this.box.style.left=-e.left+"px",this.box.style.right="auto"}}close(){this.showing&&(this.clearCursor(),this.box.style.display="none",this.selection.classList.remove(this.options.classNames.focus),this.options.arrow&&(this.arrow.innerHTML=this.options.arrow.down),this.showing=!1)}setCursor(e){this.cursorActive&&(this.clearCursor(),e===this.box.childNodes.length?e=0:-1===e&&(e=this.box.childNodes.length-1),this.cursor=e,this.box.childNodes[this.cursor].classList.add(this.options.classNames.cursor),this.scrollIntoBoxView(this.box.childNodes[this.cursor]))}scrollIntoBoxView(e){const t=e.getBoundingClientRect();t.top<0?this.box.scrollTop-=t.top:t.bottom>window.innerHeight&&(this.box.scrollTop-=window.innerHeight-t.bottom)}clearCursor(){null!==this.cursor&&this.box.childNodes[this.cursor].classList.remove(this.options.classNames.cursor)}force(e){if(this.options.multiple){for(let t=0;t<this.falldown.length;t++)-1!==e.indexOf(t)?(this.box.childNodes[t].classList.add(this.options.classNames.select),this.falldown[t].selected=!0):(this.box.childNodes[t].classList.remove(this.options.classNames.select),this.falldown[t].selected=!1);this.showSelection()}else{for(let t=0;t<this.falldown.length;t++)this.falldown[t].value===e?(this.box.childNodes[t].classList.add(this.options.classNames.select),this.falldown[t].selected=!0,this.selection.innerHTML=e):(this.box.childNodes[t].classList.remove(this.options.classNames.select),this.falldown[t].selected=!1);this.showSelection()}}remove(e){return this.box.childNodes[e].classList.remove(this.options.classNames.select),this.falldown[e].selected=!1,this.showSelection()}showSelection(){const e=[];for(let t=0;t<this.falldown.length;t++)this.falldown[t].selected&&e.push(this.falldown[t].html);if(e.length>1)if(this.options.multipleName)this.selected.innerHTML=e.length+this.options.multipleName;else{let t="";for(let s=0;s<e.length-1;s++)t+=e[s]+(this.options.multipleSeparator||", ");this.selected.innerHTML=t+e[e.length-1]}else 1===e.length?this.selected.innerHTML=e[0]:this.selected.innerHTML="";return e}clear(){for(let e=0;e<this.falldown.length;e++)this.box.childNodes[e].classList.remove(this.options.classNames.select),this.falldown[e].selected=!1;this.showSelection()}selectByHTML(e){for(let t=0;t<this.falldown.length;t++)if(this.falldown.html===e)return this.select(t)}select(e){if(this.cursor&&this.clearCursor(),this.options.multiple){const t=this.falldown[e];return t.selected=!t.selected,this.box.childNodes[e].classList.toggle(this.options.classNames.select),this.showSelection(),this.setCursor(e),{changed:t,value:this.value,falldown:this}}for(let t=0;t<this.falldown.length;t++)t===e?(this.box.childNodes[t].classList.add(this.options.classNames.select),this.falldown[t].selected=!0):(this.box.childNodes[t].classList.remove(this.options.classNames.select),this.falldown[t].selected=!1);return this.showSelection(),{changed:this.falldown[e],value:this.value,falldown:this}}getIndex(){const e=[];for(let t=0;t<this.falldown.length;t++)this.falldown[t].selected&&e.push(t);return this.options.multiple?e:e.length?e[0]:null}selectDelta(e,t){if(this.options.multiple)this.setCursor(null===this.cursor?0:this.cursor+e);else{let s=this.getIndex();null===s?s=t:(s+=e,s=s<0?this.falldown.length+s:s,s=s>=this.falldown.length?s-this.falldown.length:s),this.box.childNodes[s].scrollIntoView(),this.emit("select",this.select(s))}}static cancel(){const e=n.active;e&&e.showing&&e.close()}static keydown(e){const t=n.active;if(t)switch(e.key){case"ArrowDown":t.cursorActive=!0,t.showing?t.selectDelta(1,0):t.open(),e.preventDefault();break;case"ArrowUp":t.cursorActive=!0,t.showing?t.selectDelta(-1,t.box.childNodes.length-1):t.open(),e.preventDefault();break;case"Space":case"Enter":case" ":t.cursorActive=!0,t.showing?t.options.multiple?(t.emit("select",t.select(t.cursor)),t.options.multiple||t.close()):t.close():t.open(),e.preventDefault();break;case"Escape":t.cursorActive=!1,t.close(),e.preventDefault()}}static load(e="falldown"){const t=document.querySelectorAll("."+e);for(let e=0;e<t.length;e++)new n({element:t[e]})}static resize(){const e=n.active;e&&e.showing&&e.resizeBox()}}e.FallDown=n,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=falldown.js.map
